## 2024-05-24 - [Packet Parsing Buffer Overflow]
**Vulnerability:** Identified buffer read overflow vulnerabilities in `loadInt32String`, `loadInt16String`, and `loadInt8String` within `source/common/MiscFunctions.cpp`. These functions failed to properly validate that the string size header and subsequent payload resided within the bounds of the packet buffer, allowing out-of-bounds reads on malformed or malicious packets. Specifically, the original check `(size + *pos + sizeof(T)) > buffer_size` failed to account for `size` being 1 byte past the header when `buffer_size` exactly matched the header size, and did not check for negative `size` values.
**Learning:** Legacy packet parsing code often trusts the size variable read from the network without validating it against the remaining buffer size. Relying on side-effects of pointer arithmetic (`buffer += *pos`) before validation can be confusing and error-prone. In C/C++, always validate `offset + header_size <= buffer_size` *before* reading the header, and `offset + header_size + payload_size <= buffer_size` *before* reading the payload.
**Prevention:** Implement strict bounds checking: 1) Verify offset is valid. 2) Verify header fits. 3) Read size. 4) Verify size is non-negative. 5) Verify `offset + header + size` fits in buffer. Use explicit pointer arithmetic for clarity.
